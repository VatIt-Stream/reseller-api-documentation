openapi: 3.0.0

info:
  description: "This API provides basic accessibility to some of Stream's system. The documentation below outlines the authentication process as well as various endpoints that you will have access to as a client of the API."
  version: "1.0.0"
  title: Stream Partner API
  termsOfService: 'https://vatit-stream.com/terms_and_conditions'
  contact:
    email: developers@vatitstream.com
  license:
    name: Apache 2.0
    url: 'http://www.apache.org/licenses/LICENSE-2.0.html'

servers:
  # Added by API Auto Mocking Plugin
  - description: Stream Reseller API
    url: http://localhost:4000/reseller_api/v1/

tags:
  - name: address
    description: Addresses are stored separately to entities such as companies. Each company has an address.
  - name: company
    description: The businesses that will have access to the Stream interface. A company can have many users.
  - name: billing_group
    description: The billing group you choose determines the bank account and business entity that you will collect payments into (receivable billing company) as well as our business entity that you will make payments to. These can be configured via the Reseller portal
  - name: user
    description: A company user

paths:

  /addresses/{id}:
    patch:
      tags:
        - address
      summary: Update an address
      parameters:
        - name: id
          in: path
          description: id of an existing address
          required: true
          schema:
            type: integer
            example: 182735
      requestBody:
        $ref: '#/components/requestBodies/Address'
      responses:
        '201':
          $ref: '#/components/responses/GetAddress'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'
        '404':
          description: Resource Not Found
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/responses/CompanyNotFound'
        '422':
          description: Unprocessible Entity

  /billing_groups:
    get:
      tags:
        - billing_group
      summary: Retrieve all billing groups for your partner account
      responses:
        '200':
          $ref: '#/components/responses/GetBillingGroups'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'

  /companies:
    get:
      tags:
        - company
      summary: Retrieve all companies
      responses:
        '200':
          $ref: '#/components/responses/GetCompanies'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'

  /company_setups:
    post:
      tags:
        - company
      summary: Add a new company
      requestBody:
        $ref: '#/components/requestBodies/Company'
      responses:
        '201':
          $ref: '#/components/responses/CreateCompany'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'

        '422':
          $ref: '#/components/responses/UnprocessableEntity'

        '500':
          description: Internal Server Error

  /companies/{id}:
    get:
      tags:
        - company
      summary: Retrieve company details with specified ID
      parameters:
        - name: id
          in: path
          description: id of an existing company
          required: true
          explode: true
          schema:
            type: string
            example: "807"
      responses:
        '200':
          $ref: '#/components/responses/GetCompany'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'
        '404':
          $ref: '#/components/responses/CompanyNotFound'

    patch:
      tags:
        - company
      summary: Update an existing company
      parameters:
        - name: id
          in: path
          description: id of an existing company
          required: true
          explode: true
          schema:
            type: string
            example: "0"
      requestBody:
        $ref: '#/components/requestBodies/Company'
      responses:
        '200':
          $ref: '#/components/responses/CreateCompany'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'
        '404':
          $ref: '#/components/responses/CompanyNotFound'

  /api_users:
    get:
      tags:
        - user
      summary: Retrieve all users
      responses:
        '200':
          $ref: '#/components/responses/GetApiUsers'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'

    post:
      tags:
        - user
      summary: Create a new user account
      requestBody:
        content:
            application/json:
              schema:
                properties:
                  api_user:
                    type: object
                    $ref: '#/components/schemas/ApiUser'

      responses:
        '201':
          $ref: '#/components/responses/CreateApiUser'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'
        '422':
          $ref: '#/components/responses/UnprocessableEntity'

  /api_users/{id}:
    get:
        tags:
          - user
        summary: Retrieve the current users details
        parameters:
        - name: id
          in: path
          description: id of an existing user
          required: true
          explode: true
          schema:
            type: string
            example: "1"
        responses:
          '200':
            $ref: '#/components/responses/GetApiUser'
          '401':
            $ref: '#/components/responses/UnauthorizedAccess'

    patch:
      tags:
        - user
      summary: Update user details
      parameters:
        - name: id
          in: path
          description: id of an existing user
          required: true
          explode: true
          schema:
            type: string
            example: "1984"
      requestBody:
        content:
          application/json:
            schema:
              properties:
                api_user:
                  type: object
                  $ref: '#/components/schemas/ApiUser'


      responses:
        '201':
          $ref: '#/components/responses/CreateApiUser'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'
        '404':
          $ref: '#/components/responses/ApiUserNotFound'

    delete:
      tags:
        - user
      summary: Delete a user
      parameters:
        - name: id
          in: path
          description: id of an existing user
          required: true
          explode: true
          schema:
            type: string
            example: "0000"
      responses:
        '200':
          $ref: '#/components/responses/DeleteApiUser'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'
        '404':
          $ref: '#/components/responses/ApiUserNotFound'

  /companies/{id}/api_users:
    get:
      tags:
        - user
      summary: Retrieve users for a specific company
      parameters:
        - name: id
          in: path
          description: id of an existing company
          required: true
          explode: true
          schema:
            type: string
            example: "1984"
      responses:
        '200':
          $ref: '#/components/responses/GetApiUsers'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'
        '404':
          description: Coudn't find requested company
          $ref: '#/components/responses/CompanyNotFound'

  /resellers/{id}/api_users:
    get:
      tags:
        - user
      summary: Retrieve users for a specific reseller
      parameters:
        - name: id
          in: path
          description: id of an existing reseller
          required: true
          explode: true
          schema:
            type: string
            example: "1984"
      responses:
        '200':
          $ref: '#/components/responses/GetApiUsers'
        '401':
          $ref: '#/components/responses/UnauthorizedAccess'

components:
  schemas:

    ApiUser:
      type: object
      required:
        - api_user
      properties:
        email:
          type: string
          example: "test@company.com"
        password:
          type: string
          example: "123456"
        company_id:
          type: integer
          example: 807
        admin:
          type: boolean
          example: false

    ApiUserResponseBody:
        type: object
        properties:
          api_user:
            type: object
            properties:
              id:
                type: integer
                example: 2281
              email:
                type: string
              admin:
                type: boolean
              company_id:
                type: integer
              company_name:
                type: string
              role:
                type: string
              contact_number:
                type: string
              first_name:
                type: string
              last_name:
                type: string
              whats_new_viewed_datetime:
                type: string
                example: "2020-01-01T00:00:00.000Z"
              company_currency_id:
                type: string
              deactivated:
                type: boolean
                example: false
              reseller:
                type: object
                properties:
                  id:
                    type: integer
                    example: 2
                  name:
                    type: string
                  website_configuration:
                    type: object
                    properties:
                      primary_colors:
                        type: string
                  base_markup:
                    type: number
                    example: 0.0
                  billing_company_id:
                    type: integer
                    example: 5
                  own_billing_company_id:
                    type: integer
                    example: 6
                  ui_url:
                    type: string
                    example: https://testship.company.com/
                  processing_fee_percentage:
                    type: number
                    example: 0.0
                  profit_sharing_percentage:
                    type: number
                    example: 0.4
                  sender_email:
                    type: string
                    example: "reply@testship.com"
                  no_reply_email:
                    type: string
                    example:  "no_reply@testship.com"
                  email_sender_name:
                    type: string
                    example: "Test Update"
                  account_status:
                    type: string
                    example: "active_account"
                  internal_name:
                    type: string
                    example: "Internal Company Name"
                  invoice_email:
                    type: string
                    example: "invoices@testship.com"
                  currency_id:
                    type: string
                    example: "ZAR"
                  reseller_estimate_calculation:
                    type: string
                    example: calculate_off_cost_price_estimate
                  billing_config:
                    type: string
                    example: "reseller_billing"
                  flat_commission_percentage:
                    type: number
                    example: 0.0
                  minimum_company_markup:
                    type: number
                    example: 1.4
                  beta_ui_url:
                    type: string

    Address:
      type: object
      properties:
        address_1:
          type: string
          example: "Address line 1"
        address_2:
          type: string
          example: "Address line 2"
        city:
          type: string
          example: "City"
        province:
          type: string
          example: "Province"
        postal_code:
          type: string
          example: "1956"
        country_code:
          type: string
          example: "ZA"

    BillingGroup:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        reseller_id:
          type: integer
        currency_id:
          type: string
        reseller_receivable_billing_company_id:
          type: integer
        reseller_payable_billing_company_id:
          type: integer
        receivable_billing_company_id:
          type: integer
        reseller_receivable_billing_company:
          $ref: '#/components/schemas/ResellerReceivableBillingCompany'
        reseller_payable_billing_company:
          $ref: '#/components/schemas/ResellerPayableBillingCompany'

    BillingGroups:
      type: object
      properties:
        billing_groups:
          type: array
          items:
            $ref: '#/components/schemas/BillingGroup'

    ResellerReceivableBillingCompany:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
          example: ExampleName
        internal_name:
          type: string
        registration_number:
          type: string
        vat_number:
          type: string
        address_1:
          type: string
        address_2:
          type: string
        country:
          type: string
        number:
          type: string
        email:
          type: string
        invoice_note:
          type: string
        billing_detail_currency:
          type: string
        bank_detail_id:
          type: integer
        xero_account_id:
          type: integer
        xero_contactable:
          type: boolean

    ResellerPayableBillingCompany:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        internal_name:
          type: string
        registration_number:
          type: string
        vat_number:
          type: string
        address_1:
          type: string
        address_2:
          type: string
        country:
          type: string
        number:
          type: string
        email:
          type: string
        invoice_note:
          type: string
        billing_detail_currency:
          type: string
        bank_detail_id:
          type: integer
        xero_account_id:
          type: integer
        xero_contactable:
          type: boolean

    MarkupConfig:
      type: object
      properties:
        markup_percentage:
          type: number
          example: 1.01

    Company:
      type: object
      properties:
            id:
              type: integer
              format: int64
            name:
              type: string
              example: Netflix PTY Ltd
            currency_id:
              type: string
              example: "USD"
            contact_name:
              type: string
              example: "Joe Soap"
            contact_number:
              type: string
              example: "11111111"
            contact_email:
              type: string
              example: "joesoap@netflix.com"
            invoice_due_days:
              type: integer
              example: 7
            address:
              $ref: '#/components/schemas/Address'
            incoterms:
              type: array
              description: An array of incoterms
              items:
                type: string
                example: "DDP"
            api_users:
              type: array
              items:
                $ref: '#/components/schemas/ApiUser'
            markup_config:
              $ref: '#/components/schemas/MarkupConfig'

    CompanyResponseBody:
      type: object
      properties:
            id:
              type: integer
              format: int64
            name:
              type: string
              example: Testflix PTY Ltd
            code:
              type: string
              example: "RESTES001"
            automation_waybill:
              type: boolean
            automate_pickup:
              type: boolean
            contact_name:
              type: string
              example: "Joe Soap"
            contact_number:
              type: string
              example: "11111111"
            vat_number:
              type: string
              example: "null"
            account_number:
              type: string
              example: "RESTES001"
            email:
              type: string
              example: "test@test.com"
            ccd_required:
              type: boolean
            payment_terms:
              type: integer
              example: 7
            billing_company_id:
              type: integer
              example: 5
            pay_to_billing_company_id:
              type: integer
              example: 5
            currency_id:
              type: string
              example: "USD"
            waybill_cc_email:
              type: string
            invoice_cc_email:
              type: string
            reseller_chat_recipients_override:
              type: string
            customs_clearance_document_cc_email:
              type: string
            address_id:
              type: integer
              example: 188149
            currency_code:
              type: string
              example: "USD"
            country_id:
              type: integer
              example: 205
            part_of_vat_group:
              type: boolean
              example: false
            estimate_presentation_configuration_id:
              type: integer
              example: 2
            purpose_of_shipment_ids:
              type: array
              items:
                type: integer
                example: 8
            sales_persons_id:
              type: integer
              example: 8
            account_manager_id:
              type: integer
              example: 2
            client_agreement_document_link:
              type: string
            credit_application_link:
              type: string
            credit_limit:
              type: number
              example: 0.0
            credit_limit_currency_id:
              type: string
              example: "USD"
            credit_used:
              type: number
              example: 0.0
            account_status:
              type: string
              example: "active_account"
            manual_quote_cc_email:
              type: string
              example: 'manual@testflix.com'
            allow_auto_billing:
              type: boolean
            shipping_company_ids:
              type: array
              items:
                type: integer
                example: 19999
            quoteable_shipping_company_ids:
              type: array
              items:
                type: integer
                example: 5,
            allow_client_waybill_generation:
              type: boolean
            quote_setup:
              type: object
              properties:
                id:
                  type: integer
                  example: 2
                can_packages_be_stacked_display:
                  type: boolean
                can_packages_be_stacked_value:
                  type: boolean
                company_id:
                  type: integer
                shipment_protection_display:
                  type: boolean
                shipment_protection_value:
                  type: boolean
                dangerous_goods_verified:
                  type: boolean
                accepted_dangerous_good_is:
                  type: array
                  items:
                    type: integer
                allowed_quote_types:
                  type: array
                  items:
                    type: string
                    example: "international"
                can_customize_ior:
                  type: boolean
                can_appoint_ior:
                  type: boolean
                is_document_value:
                  type: boolean
                require_hs_codes_for_ddp:
                  type: boolean
                estimate_taxes_and_duties_display:
                  type: boolean
                commercial_transaction_of_goods_display:
                  type: boolean
                commercial_transaction_of_goods_value:
                  type: boolean
            reseller_company:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1900
                  reseller_id:
                    type: integer
                  company_id:
                    type: integer
                    example: 807
                  created_at:
                    type: string
                    example: "2021-06-29T10:54:03.789Z"
                  updated_at:
                    type: string
                    example: "2021-06-29T10:54:03.789Z"
            markup_config:
              type: object
              properties:
                id:
                  type: integer
                company_id:
                  type: integer
                  example: 807
                markup_percentage:
                  type: number
                  example: 1.5
                created_at:
                  type: string
                  example: "2021-06-29T10:54:03.789Z"
                updated_at:
                  type: string
                  example: "2021-06-29T10:54:03.789Z"

    BaseError:
      type: object
      properties:
        error:
          type: string

    ExtendedError:
      allOf:
        - $ref: '#/components/schemas/BaseError'
        - type: object
          properties:
            success:
              type: boolean

  responses:

    GetAddress:
      description: Created
      content:
        application/json:
          schema:
            properties:
              address:
                type: object
                properties:
                  id:
                    type: integer
                    example: 182735
                  name:
                    type: string
                    example: Joe Soap
                  company:
                    type: string
                    example: Example PTY Ltd
                  email:
                    type: string
                    example: "joe.soap@example.io"
                  address_1:
                    type: string
                    example: 10 Test Street
                  address_2:
                    type: string
                    example: Test Suburb
                  address_3:
                    type: string
                  postal_code:
                    type: string
                    example: 1000
                  city:
                    type: string
                    example: Johannesburg
                  province:
                    type: string
                    example: Gauteng
                  phone:
                    type: string
                    example: "082 100 1000"
                  country_id:
                    type: string
                    example: 205
                  summary:
                    type: string
                    example: South Africa
                  tax_number:
                    type: string
                    example: "10101"
                  import_code:
                    type: string
                    example: "CUS00121"
                  export_code:
                    type: string
                    example: "CUS00122"
                  longitude:
                    type: string
                    example: "26.2041"
                  latitude:
                    type: string
                    example: "28.0473"
                  time_zone_id:
                    type: string
                    example: "Africa/Johannesburg"
                  country:
                    type: object
                    properties:
                      id:
                        type: integer
                        example: "205"
                      name:
                        type: string
                        example: "South Africa"
                      iso_code_2:
                        type: string
                        example: "ZA"
                      iso_code_3:
                        type: string
                        example: "ZAF"
                      postal_code_required:
                        type: boolean
                        example: true
                      export_code_label:
                        type: string
                        example: "EIN"
                      import_code_label:
                        type: string
                        example: "EIN"
                      tax_number_label:
                        type: string
                        example: "Tax Number"
                      vat_rate:
                        type: number
                        example: 0.15
                      default_postal_code:
                        type: string
                        example: "10001"

    GetApiUser:
      description: OK
      content:
        application/json:
          schema:
            properties:
              user:
                $ref: '#/components/schemas/ApiUserResponseBody'

    GetApiUsers:
      description: OK
      content:
        application/json:
          schema:
            properties:
              api_users:
                type: array
                items:
                  $ref: '#/components/schemas/ApiUserResponseBody'

    GetBillingGroups:
      description: OK
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/BillingGroups'

    GetCompany:
      description: OK
      content:
        application/json:
          schema:
            properties:
              company:
                $ref: '#/components/schemas/CompanyResponseBody'

    GetCompanies:
      description: OK
      content:
        application/json:
          schema:
            properties:
              companies:
                type: array
                items:
                  $ref: '#/components/schemas/CompanyResponseBody'

    CreateCompany:
      description: Created
      content:
        application/json:
          schema:
              properties:
                company:
                  $ref: '#/components/schemas/CompanyResponseBody'

    CreateApiUser:
      description: Created
      content:
        application/json:
          schema:
            allOf:
              - $ref: '#/components/schemas/ApiUserResponseBody'

    DeleteApiUser:
      description: OK
      content:
        application/json:
          schema:
            properties:
              message:
                type: string
                example: "User has successfully been deleted"

    UnauthorizedAccess:
      description: Unauthorized access.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/BaseError'
          example:
            error:  "You need to sign in or sign up before continuing"

    CompanyNotFound:
      description: The specified company could not be found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/BaseError'
          example:
            error: "Couldn't find Company with 'id'= 111"

    PageNotFound:
      description: The specified page could not be found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/BaseError'
          example:
            error: "The page you requested does not exist"

    ApiUserNotFound:
      description: The specified ApiUser could not be found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/BaseError'
          example:
            error: "Couldn't find ApiUser with 'id'= 2277"

    UnprocessableEntity:
      description: "Error: Unprocessable Entity"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ExtendedError'
          example:
            success: false
            error: \"name":[\"has already been taken\"]

  requestBodies:
    ApiUser:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ApiUser'
      description: ApiUser Object
      required: true

    Address:
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Address'
      description: Address object
      required: true

    Company:
      content:
        application/json:
          schema:
            properties:
              company:
                type: object
                $ref: '#/components/schemas/Company'
      description: Company Object
      required: true

  securitySchemes:
      OAuth:
        type: oauth2
        description: This API uses OAuth 2 with the client credentials flow.
        flows:
          clientCredentials:
            tokenUrl: http://localhost:4000/oauth/token
            scopes:
              public: Public scope

security:
        - OAuth:
          - public
